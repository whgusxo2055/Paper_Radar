<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{layout :: head('Institution - PAPER_RADAR')}"></head>
  <body>
    <header th:replace="~{layout :: header}"></header>
    <main class="container">
      <h1>Institution</h1>

      <div class="alert" th:if="${error != null}">
        <strong th:text="${error}">error</strong>
      </div>

      <section class="section" th:if="${analysis != null}">
        <div class="card">
          <h2 class="title" th:text="${analysis.displayName}">displayName</h2>
          <div class="muted small" th:text="${analysis.institutionId}">id</div>
          <div class="actions">
            <a class="button secondary" th:href="@{/search(instId=${analysis.institutionId})}">이 기관으로 검색</a>
          </div>
        </div>

        <div class="grid section">
          <div class="card">
            <div class="muted">최근 30일 논문 수</div>
            <div style="font-size: 28px; font-weight: 700" th:text="${analysis.works30d}">0</div>
          </div>
          <div class="card">
            <div class="muted">최근 90일 논문 수</div>
            <div style="font-size: 28px; font-weight: 700" th:text="${analysis.works90d}">0</div>
          </div>
        </div>

        <section class="section">
          <div class="row">
            <h2>Top Keywords</h2>
            <div class="actions">
              <a class="button secondary"
                 th:href="@{/institution/{eid}(eid=${encodedInstitutionId},kwWindow=30)}"
                 th:classappend="${kwWindow == 30} ? ' active' : ''">
                최근 30일
              </a>
              <a class="button secondary"
                 th:href="@{/institution/{eid}(eid=${encodedInstitutionId},kwWindow=90)}"
                 th:classappend="${kwWindow == 90} ? ' active' : ''">
                최근 90일
              </a>
            </div>
          </div>
          <div class="card" th:if="${#lists.isEmpty(analysis.topKeywords)}">
            <p class="muted">키워드가 없습니다.</p>
          </div>
          <div class="card" th:if="${!#lists.isEmpty(analysis.topKeywords)}">
            <div class="chips">
              <a class="chip"
                 th:each="k : ${analysis.topKeywords}"
                 th:href="@{/search(instId=${analysis.institutionId},keyword=${k})}"
                 th:text="${k}">
                keyword
              </a>
            </div>
          </div>
        </section>

        <section class="section">
          <div class="row">
            <h2>Recent Works</h2>
            <div class="muted" th:text="${#lists.size(analysis.recentWorks)} + ' items'"></div>
          </div>
          <div class="card" th:if="${#lists.isEmpty(analysis.recentWorks)}">
            <p class="muted">최근 논문이 없습니다.</p>
          </div>
          <div class="list" th:if="${!#lists.isEmpty(analysis.recentWorks)}">
            <article class="card" th:each="w : ${analysis.recentWorks}">
              <h3 class="title">
                <a th:href="@{/work/{eid}(eid=${T(com.paperradar.work.util.WorkIdCodec).encode(w.id)})}"
                   th:text="${w.title}">
                  title
                </a>
              </h3>
              <div class="meta">
                <span th:text="${w.publicationDate}">date</span>
              </div>
              <div class="actions">
                <a class="button secondary"
                   th:href="@{/work/{eid}(eid=${T(com.paperradar.work.util.WorkIdCodec).encode(w.id)})}">
                  상세
                </a>
                <a class="button secondary"
                   th:if="${w.bestLinkUrl != null and !w.bestLinkUrl.isBlank()}"
                   th:href="${w.bestLinkUrl}"
                   target="_blank"
                   rel="noopener noreferrer"
                   th:text="${w.bestLinkType != null and !w.bestLinkType.isBlank()} ? ('원문(' + ${w.bestLinkType} + ')') : '원문'">
                  원문
                </a>
              </div>
            </article>
          </div>
        </section>
      </section>
    </main>
    <footer th:replace="~{layout :: footer}"></footer>
  </body>
</html>
