<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{layout :: head('PAPER_RADAR')}"></head>
  <body>
    <header th:replace="~{layout :: header}"></header>
    <main class="container">
      <h1>PAPER_RADAR</h1>
      <p class="muted">논문·기술 트렌드 레이더 (내부 서비스)</p>
      <div class="actions">
        <a class="button" th:href="@{/search}">검색으로 이동</a>
        <a class="button secondary" th:href="@{/admin/keywords}">관리 화면</a>
      </div>

      <section class="section">
        <div class="row">
          <h2>Keyword Trends (Top 20)</h2>
          <div class="muted">trend_score / MA7 / MA30 / 30d total</div>
        </div>
        <div class="card" th:if="${keywordTrends == null or #lists.isEmpty(keywordTrends)}">
          <p class="muted">표시할 키워드 트렌드가 없습니다. (Admin에서 키워드를 활성화하세요)</p>
        </div>
        <div class="card" th:if="${keywordTrends != null and !#lists.isEmpty(keywordTrends)}">
          <div class="trend-head">
            <div>#</div>
            <div>Keyword</div>
            <div class="right">trend</div>
            <div class="right">MA7</div>
            <div class="right">MA30</div>
            <div class="right">30d</div>
          </div>
          <div class="trend-row" th:each="it,stat : ${keywordTrends}">
            <div th:text="${stat.count}">1</div>
            <div>
              <a th:href="@{/search(keyword=${it.key})}" th:text="${it.label}">keyword</a>
            </div>
            <div class="right" th:text="${#numbers.formatDecimal(it.trendScore, 1, 3)}">0.000</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.ma7, 1, 2)}">0.00</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.ma30, 1, 2)}">0.00</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.total30, 1, 0)}">0</div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="row">
          <h2>Institution Trends (Top 20)</h2>
          <div class="muted">trend_score / MA7 / MA30 / 30d total</div>
        </div>
        <div class="card" th:if="${institutionTrends == null or #lists.isEmpty(institutionTrends)}">
          <p class="muted">표시할 기관 트렌드가 없습니다. (Admin에서 기관을 활성화하세요)</p>
        </div>
        <div class="card" th:if="${institutionTrends != null and !#lists.isEmpty(institutionTrends)}">
          <div class="trend-head">
            <div>#</div>
            <div>Institution</div>
            <div class="right">trend</div>
            <div class="right">MA7</div>
            <div class="right">MA30</div>
            <div class="right">30d</div>
          </div>
          <div class="trend-row" th:each="it,stat : ${institutionTrends}">
            <div th:text="${stat.count}">1</div>
            <div>
              <a th:href="@{/search(instId=${it.key})}" th:text="${it.label}">institution</a>
              <a class="muted small"
                 th:href="@{/institution/{eid}(eid=${T(com.paperradar.institution.util.InstitutionIdCodec).encode(it.key)})}">
                분석
              </a>
              <div class="muted small" th:text="${it.key}">id</div>
            </div>
            <div class="right" th:text="${#numbers.formatDecimal(it.trendScore, 1, 3)}">0.000</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.ma7, 1, 2)}">0.00</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.ma30, 1, 2)}">0.00</div>
            <div class="right" th:text="${#numbers.formatDecimal(it.total30, 1, 0)}">0</div>
          </div>
        </div>
      </section>
    </main>
    <footer th:replace="~{layout :: footer}"></footer>
  </body>
</html>
