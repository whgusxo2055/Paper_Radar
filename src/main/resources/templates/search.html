<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{layout :: head('Search - PAPER_RADAR')}"></head>
  <body>
    <header th:replace="~{layout :: header}"></header>
    <main class="container">
      <div class="row">
        <h1>검색</h1>
      </div>

      <form class="card" method="get" th:action="@{/search}" th:object="${req}">
        <div class="grid grid-4">
          <div class="span-full">
            <label for="q">검색어</label>
            <input id="q" th:field="*{q}" type="search" placeholder="논문 제목, 초록 등 검색..." />
          </div>
          <div class="span-2">
            <label for="instId">기관</label>
            <input id="instId" th:field="*{instId}" type="text" placeholder="기관명 또는 ID (자동완성)" />
          </div>
          <div class="span-2">
            <label for="keyword">키워드</label>
            <input id="keyword" th:field="*{keyword}" type="text" placeholder="키워드" />
          </div>
          <div class="span-2">
            <label for="author">저자</label>
            <input id="author" th:field="*{author}" type="text" placeholder="저자명" />
          </div>
          <div>
            <label for="from">시작일</label>
            <input id="from" th:field="*{from}" type="date" />
          </div>
          <div>
            <label for="to">종료일</label>
            <input id="to" th:field="*{to}" type="date" />
          </div>
          <div>
            <label for="sort">정렬</label>
            <select id="sort" th:field="*{sort}">
              <option value="relevance">관련도순</option>
              <option value="newest">최신순</option>
              <option value="cited">인용순</option>
            </select>
          </div>
          <div>
            <label for="size">표시 개수</label>
            <input id="size" th:field="*{size}" type="number" min="1" max="50" />
          </div>
        </div>

        <div class="actions" style="margin-top: 1.5rem; justify-content: flex-end;">
          <a class="button secondary" th:href="@{/search}">초기화</a>
          <button class="button" type="submit">검색</button>
        </div>

        <div class="alert" th:if="${errors != null and !errors.isEmpty()}">
          <strong>입력 오류</strong>
          <ul>
            <li th:each="e : ${errors}" th:text="${e}"></li>
          </ul>
        </div>
      </form>

      <section class="section" th:if="${result != null}">
        <div class="row">
          <h2>검색 결과</h2>
          <div class="muted" th:text="'총 ' + ${result.total} + '건'"></div>
        </div>

        <div class="card" th:if="${result.items.isEmpty()}">
          <p class="muted">검색 결과가 없습니다.</p>
        </div>

        <div class="list" th:if="${!result.items.isEmpty()}">
          <article class="card" th:each="it : ${result.items}" style="margin-bottom: 1rem;">
            <h3 class="title">
              <a th:href="@{/work/{eid}(eid=${T(com.paperradar.work.util.WorkIdCodec).encode(it.id)})}"
                 th:text="${it.title}">
                title
              </a>
            </h3>
            <div class="meta" style="margin-top: 0.5rem;">
              <span th:if="${it.institutions != null and !it.institutions.isBlank()}" th:text="${it.institutions}">institutions</span>
              <span th:text="${it.publicationDate}">date</span>
            </div>
            <div class="actions" style="margin-top: 1rem;">
              <a class="button secondary small"
                 th:href="@{/work/{eid}(eid=${T(com.paperradar.work.util.WorkIdCodec).encode(it.id)})}">
                상세보기
              </a>
              <a class="button secondary small"
                 th:if="${it.bestLinkUrl != null and !it.bestLinkUrl.isBlank()}"
                 th:href="${it.bestLinkUrl}"
                 target="_blank"
                 rel="noopener noreferrer">
                 <span th:text="${it.bestLinkType != null and !it.bestLinkType.isBlank()} ? ('원문 (' + ${it.bestLinkType} + ')') : '원문 보기'">원문</span>
                 <span style="margin-left: 4px;">↗</span>
              </a>
            </div>
          </article>
        </div>

        <div class="pager" th:if="${result.total > 0}" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;">
          <a class="button secondary"
             th:if="${result.page > 1}"
             th:href="@{/search(q=${req.q},keyword=${req.keyword},instId=${req.instId},author=${req.author},from=${req.from},to=${req.to},sort=${req.sort},size=${req.size},page=${req.page - 1})}">
            이전
          </a>
          <span class="muted" th:text="${result.page} + ' / ' + ${result.totalPages()}"></span>
          <a class="button secondary"
             th:if="${result.page < result.totalPages()}"
             th:href="@{/search(q=${req.q},keyword=${req.keyword},instId=${req.instId},author=${req.author},from=${req.from},to=${req.to},sort=${req.sort},size=${req.size},page=${req.page + 1})}">
            다음
          </a>
        </div>
      </section>
    </main>
    <footer th:replace="~{layout :: footer}"></footer>
  </body>
</html>
